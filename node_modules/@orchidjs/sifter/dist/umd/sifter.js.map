{"version":3,"file":"sifter.js","sources":["../../lib/diacritics.ts","../../lib/utils.ts","../../lib/sifter.ts"],"sourcesContent":["\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { escape_regex } from './utils.ts';\n\ntype TDiacraticList = {[key:string]:string};\n\n// https://github.com/andrewrk/node-diacritics/blob/master/index.js\n\nvar latin_pat:RegExp;\nconst accent_pat = '[\\u0300-\\u036F\\u{b7}\\u{2be}]'; // \\u{2bc}\nconst accent_reg = new RegExp(accent_pat,'gu');\nvar diacritic_patterns:TDiacraticList;\n\nconst latin_convert:TDiacraticList = {\n\t'æ': 'ae',\n\t'ⱥ': 'a',\n\t'ø': 'o',\n};\n\nconst convert_pat = new RegExp(Object.keys(latin_convert).join('|'),'gu');\n\nconst code_points:[[number,number]] = [[ 0, 65535 ]];\n\n/**\n * Remove accents\n * via https://github.com/krisk/Fuse/issues/133#issuecomment-318692703\n *\n */\nexport const asciifold = (str:string):string => {\n\treturn str\n\t\t.normalize('NFKD')\n\t\t.replace(accent_reg, '')\n\t\t.toLowerCase()\n\t\t.replace(convert_pat,function(foreignletter) {\n\t\t\treturn latin_convert[foreignletter] || foreignletter;\n\t\t});\n};\n\n/**\n * Convert array of strings to a regular expression\n *\tex ['ab','a'] => (?:ab|a)\n * \tex ['a','b'] => [ab]\n *\n */\nexport const arrayToPattern = (chars:string[],glue:string='|'):string =>{\n\n\tif( chars.length === 1 && chars[0] != undefined ){\n\t\treturn chars[0];\n\t}\n\n\tvar longest = 1;\n\tchars.forEach((a)=>{longest = Math.max(longest,a.length)});\n\n\tif( longest == 1 ){\n\t\treturn '['+chars.join('')+']';\n\t}\n\n\treturn '(?:'+chars.join(glue)+')';\n};\n\nexport const escapeToPattern = (chars:string[]):string =>{\n\tconst escaped = chars.map((diacritic) => escape_regex(diacritic));\n\treturn arrayToPattern(escaped);\n};\n\n/**\n * Get all possible combinations of substrings that add up to the given string\n * https://stackoverflow.com/questions/30169587/find-all-the-combination-of-substrings-that-add-up-to-the-given-string\n *\n */\nexport const allSubstrings = (input:string):string[][] => {\n\n    if( input.length === 1) return [[input]];\n\n    var result:string[][] = [];\n    allSubstrings(input.substring(1)).forEach(function(subresult) {\n        var tmp = subresult.slice(0);\n        tmp[0] = input.charAt(0) + tmp[0];\n        result.push(tmp);\n\n        tmp = subresult.slice(0);\n        tmp.unshift(input.charAt(0));\n        result.push(tmp);\n    });\n\n    return result;\n}\n\n/**\n * Generate a list of diacritics from the list of code points\n *\n */\nexport const generateDiacritics = (code_points:[[number,number]]):TDiacraticList => {\n\n\tvar diacritics:{[key:string]:string[]} = {};\n\tcode_points.forEach((code_range)=>{\n\n\t\tfor(let i = code_range[0]; i <= code_range[1]; i++){\n\n\t\t\tlet diacritic\t= String.fromCharCode(i);\n\t\t\tlet\tlatin\t\t= asciifold(diacritic);\n\n\t\t\tif( latin == diacritic.toLowerCase() ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// skip when latin is a string longer than 3 characters long\n\t\t\t// bc the resulting regex patterns will be long\n\t\t\t// eg:\n\t\t\t// latin صلى الله عليه وسلم length 18 code point 65018\n\t\t\t// latin جل جلاله length 8 code point 65019\n\t\t\tif( latin.length > 3 ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst latin_diacritics:string[] = diacritics[latin] || [latin];\n\t\t\tconst patt = new RegExp( escapeToPattern(latin_diacritics),'iu');\n\t\t\tif( diacritic.match(patt) ){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlatin_diacritics.push(diacritic);\n\t\t\tdiacritics[latin] = latin_diacritics;\n\t\t}\n\t});\n\n\t// filter out if there's only one character in the list\n\t// todo: this may not be needed\n\tObject.keys(diacritics).forEach(latin => {\n\t\tconst latin_diacritics = diacritics[latin] || [];\n\t\tif( latin_diacritics.length < 2 ){\n\t\t\tdelete diacritics[latin];\n\t\t}\n\t});\n\n\n\t// latin character pattern\n\t// match longer substrings first\n\tlet latin_chars\t= Object.keys(diacritics).sort((a, b) => b.length - a.length );\n\tlatin_pat\t\t= new RegExp('('+ escapeToPattern(latin_chars) + accent_pat + '*)','gu');\n\n\n\t// build diacritic patterns\n\t// ae needs:\n\t//\t(?:(?:ae|Æ|Ǽ|Ǣ)|(?:A|Ⓐ|Ａ...)(?:E|ɛ|Ⓔ...))\n\tvar diacritic_patterns:TDiacraticList = {};\n\tlatin_chars.sort((a,b) => a.length -b.length).forEach((latin)=>{\n\n\t\tvar substrings\t= allSubstrings(latin);\n\t\tvar pattern = substrings.map((sub_pat)=>{\n\n\t\t\tsub_pat = sub_pat.map((l)=>{\n\t\t\t\tif( diacritics.hasOwnProperty(l) ){\n\t\t\t\t\treturn escapeToPattern(diacritics[l]!);\n\t\t\t\t}\n\t\t\t\treturn l;\n\t\t\t});\n\n\t\t\treturn arrayToPattern(sub_pat,'');\n\t\t});\n\n\t\tdiacritic_patterns[latin] = arrayToPattern(pattern);\n\t});\n\n\n\treturn diacritic_patterns;\n}\n\n/**\n * Expand a regular expression pattern to include diacritics\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n */\nexport const diacriticRegexPoints = (regex:string):string => {\n\n\tif( diacritic_patterns === undefined ){\n\t\tdiacritic_patterns = generateDiacritics(code_points);\n\t}\n\n\tconst decomposed\t\t= regex.normalize('NFKD').toLowerCase();\n\n\treturn decomposed.split(latin_pat).map((part:string)=>{\n\n\t\t// \"ﬄ\" or \"ffl\"\n\t\tconst no_accent = asciifold(part);\n\t\tif( no_accent == '' ){\n\t\t\treturn '';\n\t\t}\n\n\t\tif( diacritic_patterns.hasOwnProperty(no_accent) ){\n\t\t\treturn diacritic_patterns[no_accent];\n\t\t}\n\n\t\treturn part;\n\t}).join('');\n\n}\n","\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { asciifold } from './diacritics.ts';\n\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport * as T from './types.ts';\n\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttr = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    return obj[name];\n};\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttrNesting = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    var part, names = name.split(\".\");\n\twhile( (part = names.shift()) && (obj = obj[part]));\n    return obj;\n};\n\n/**\n * Calculates how close of a match the\n * given value is against a search token.\n *\n */\nexport const scoreValue = (value:string, token:T.Token, weight:number ):number => {\n\tvar score, pos;\n\n\tif (!value) return 0;\n\n\tvalue = value + '';\n\tpos = value.search(token.regex);\n\tif (pos === -1) return 0;\n\n\tscore = token.string.length / value.length;\n\tif (pos === 0) score += 0.5;\n\n\treturn score * weight;\n};\n\n/**\n *\n * https://stackoverflow.com/questions/63006601/why-does-u-throw-an-invalid-escape-error\n */\nexport const escape_regex = (str:string):string => {\n\treturn (str + '').replace(/([\\$\\(\\)\\*\\+\\.\\?\\[\\]\\^\\{\\|\\}\\\\])/gu, '\\\\$1');\n};\n\n\n/**\n * Cast object property to an array if it exists and has a value\n *\n */\nexport const propToArray = (obj:{[key:string]:any}, key:string) => {\n\tvar value = obj[key];\n\n\tif( typeof value == 'function' ) return value;\n\n\tif( value && !Array.isArray(value) ){\n\t\tobj[key] = [value];\n\t}\n}\n\n\n/**\n * Iterates over arrays and hashes.\n *\n * ```\n * iterate(this.items, function(item, id) {\n *    // invoked for each item\n * });\n * ```\n *\n */\nexport const iterate = (object:[]|{[key:string]:any}, callback:(value:any,key:number|string)=>any) => {\n\n\tif ( Array.isArray(object)) {\n\t\tobject.forEach(callback);\n\n\t}else{\n\n\t\tfor (var key in object) {\n\t\t\tif (object.hasOwnProperty(key)) {\n\t\t\t\tcallback(object[key], key);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nexport const cmp = (a:number|string, b:number|string) => {\n\tif (typeof a === 'number' && typeof b === 'number') {\n\t\treturn a > b ? 1 : (a < b ? -1 : 0);\n\t}\n\ta = asciifold(a + '').toLowerCase();\n\tb = asciifold(b + '').toLowerCase();\n\tif (a > b) return 1;\n\tif (b > a) return -1;\n\treturn 0;\n};\n","/**\n * sifter.js\n * Copyright (c) 2013–2020 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\n // @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { scoreValue, getAttr, getAttrNesting, escape_regex, propToArray, iterate, cmp } from './utils.ts';\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { diacriticRegexPoints } from './diacritics.ts';\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport * as T from 'types.ts';\n\nexport default class Sifter{\n\n\tpublic items; // []|{};\n\tpublic settings: T.Settings;\n\n\t/**\n\t * Textually searches arrays and hashes of objects\n\t * by property (or multiple properties). Designed\n\t * specifically for autocomplete.\n\t *\n\t */\n\tconstructor(items:any, settings:T.Settings) {\n\t\tthis.items = items;\n\t\tthis.settings = settings || {diacritics: true};\n\t};\n\n\t/**\n\t * Splits a search string into an array of individual\n\t * regexps to be used to match results.\n\t *\n\t */\n\ttokenize(query:string, respect_word_boundaries?:boolean, weights?:T.Weights ):T.Token[] {\n\t\tif (!query || !query.length) return [];\n\n\t\tconst tokens:T.Token[]\t= [];\n\t\tconst words\t\t\t\t= query.split(/\\s+/);\n\t\tvar field_regex:RegExp;\n\n\t\tif( weights ){\n\t\t\tfield_regex = new RegExp( '^('+ Object.keys(weights).map(escape_regex).join('|')+')\\:(.*)$');\n\t\t}\n\n\t\twords.forEach((word:string) => {\n\t\t\tlet field_match;\n\t\t\tlet field:null|string\t= null;\n\t\t\tlet regex:null|string\t= null;\n\n\t\t\t// look for \"field:query\" tokens\n\t\t\tif( field_regex && (field_match = word.match(field_regex)) ){\n\t\t\t\tfield\t= field_match[1]!;\n\t\t\t\tword\t= field_match[2]!;\n\t\t\t}\n\n\t\t\tif( word.length > 0 ){\n\t\t\t\tif( this.settings.diacritics ){\n\t\t\t\t\tregex = diacriticRegexPoints(word);\n\t\t\t\t}else{\n\t\t\t\t\tregex = escape_regex(word);\n\t\t\t\t}\n\t\t\t\tif( respect_word_boundaries ) regex = \"\\\\b\"+regex;\n\t\t\t}\n\n\t\t\ttokens.push({\n\t\t\t\tstring : word,\n\t\t\t\tregex  : regex ? new RegExp(regex,'iu') : null,\n\t\t\t\tfield  : field,\n\t\t\t});\n\t\t});\n\n\t\treturn tokens;\n\t};\n\n\n\t/**\n\t * Returns a function to be used to score individual results.\n\t *\n\t * Good matches will have a higher score than poor matches.\n\t * If an item is not a match, 0 will be returned by the function.\n\t *\n\t * @returns {function}\n\t */\n\tgetScoreFunction(query:string, options:T.Options ){\n\t\tvar search = this.prepareSearch(query, options);\n\t\treturn this._getScoreFunction(search);\n\t}\n\n\t_getScoreFunction(search:T.PrepareObj ){\n\t\tconst tokens\t\t= search.tokens,\n\t\ttoken_count\t\t\t= tokens.length;\n\n\t\tif (!token_count) {\n\t\t\treturn function() { return 0; };\n\t\t}\n\n\t\tconst fields\t= search.options.fields,\n\t\tweights\t\t\t= search.weights,\n\t\tfield_count\t\t= fields.length,\n\t\tgetAttrFn\t\t= search.getAttrFn;\n\n\t\tif (!field_count) {\n\t\t\treturn function() { return 1; };\n\t\t}\n\n\n\t\t/**\n\t\t * Calculates the score of an object\n\t\t * against the search query.\n\t\t *\n\t\t */\n\t\tconst scoreObject = (function() {\n\n\n\t\t\tif (field_count === 1) {\n\t\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\t\tconst field = fields[0].field;\n\t\t\t\t\treturn scoreValue(getAttrFn(data, field), token, weights[field]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn function(token:T.Token, data:{}) {\n\t\t\t\tvar sum = 0;\n\n\t\t\t\t// is the token specific to a field?\n\t\t\t\tif( token.field ){\n\n\t\t\t\t\tconst value = getAttrFn(data, token.field);\n\n\t\t\t\t\tif( !token.regex && value ){\n\t\t\t\t\t\tsum += (1/field_count);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tsum += scoreValue(value, token, 1);\n\t\t\t\t\t}\n\n\n\n\t\t\t\t}else{\n\t\t\t\t\titerate(weights, (weight:number, field:string) => {\n\t\t\t\t\t\tsum += scoreValue(getAttrFn(data, field), token, weight);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn sum / field_count;\n\t\t\t};\n\t\t})();\n\n\t\tif (token_count === 1) {\n\t\t\treturn function(data:{}) {\n\t\t\t\treturn scoreObject(tokens[0], data);\n\t\t\t};\n\t\t}\n\n\t\tif (search.options.conjunction === 'and') {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar i = 0, score, sum = 0;\n\t\t\t\tfor (; i < token_count; i++) {\n\t\t\t\t\tscore = scoreObject(tokens[i], data);\n\t\t\t\t\tif (score <= 0) return 0;\n\t\t\t\t\tsum += score;\n\t\t\t\t}\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(data:{}) {\n\t\t\t\tvar sum = 0;\n\t\t\t\titerate(tokens,(token:T.Token)=>{\n\t\t\t\t\tsum += scoreObject(token, data);\n\t\t\t\t});\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Returns a function that can be used to compare two\n\t * results, for sorting purposes. If no sorting should\n\t * be performed, `null` will be returned.\n\t *\n\t * @return function(a,b)\n\t */\n\tgetSortFunction(query:string, options:T.Options) {\n\t\tvar search  = this.prepareSearch(query, options);\n\t\treturn this._getSortFunction(search);\n\t}\n\n\t_getSortFunction(search:T.PrepareObj){\n\t\tvar i, n, implicit_score;\n\n\t\tconst self\t= this,\n\t\toptions\t\t= search.options,\n\t\tsort\t\t= (!search.query && options.sort_empty) ? options.sort_empty : options.sort,\n\t\tsort_flds:T.Sort[]\t\t= [],\n\t\tmultipliers:number[]\t= [];\n\n\n\t\tif( typeof sort == 'function' ){\n\t\t\treturn sort.bind(this);\n\t\t}\n\n\t\t/**\n\t\t * Fetches the specified sort field value\n\t\t * from a search result item.\n\t\t *\n\t\t */\n\t\tconst get_field = function(name:string, result:T.ResultItem):string|number {\n\t\t\tif (name === '$score') return result.score;\n\t\t\treturn search.getAttrFn(self.items[result.id], name);\n\t\t};\n\n\t\t// parse options\n\t\tif (sort) {\n\t\t\tfor (i = 0, n = sort.length; i < n; i++) {\n\t\t\t\tif (search.query || sort[i].field !== '$score') {\n\t\t\t\t\tsort_flds.push(sort[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// the \"$score\" field is implied to be the primary\n\t\t// sort field, unless it's manually specified\n\t\tif (search.query) {\n\t\t\timplicit_score = true;\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\timplicit_score = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (implicit_score) {\n\t\t\t\tsort_flds.unshift({field: '$score', direction: 'desc'});\n\t\t\t}\n\t\t} else {\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\tsort_flds.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\t// build function\n\t\tconst sort_flds_count = sort_flds.length;\n\t\tif (!sort_flds_count) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn function(a:T.ResultItem, b:T.ResultItem) {\n\t\t\tvar i, result, field;\n\t\t\tfor (i = 0; i < sort_flds_count; i++) {\n\t\t\t\tfield = sort_flds[i].field;\n\n\t\t\t\tlet multiplier = multipliers[i];\n\t\t\t\tif( multiplier == undefined ){\n\t\t\t\t\tmultiplier = sort_flds[i].direction === 'desc' ? -1 : 1;\n\t\t\t\t}\n\n\t\t\t\tresult = multiplier * cmp(\n\t\t\t\t\tget_field(field, a),\n\t\t\t\t\tget_field(field, b)\n\t\t\t\t);\n\t\t\t\tif (result) return result;\n\t\t\t}\n\t\t\treturn 0;\n\t\t};\n\t\t\n\t};\n\n\t/**\n\t * Parses a search query and returns an object\n\t * with tokens and fields ready to be populated\n\t * with results.\n\t *\n\t */\n\tprepareSearch(query:string, optsUser:Partial<T.Options>):T.PrepareObj {\n\t\tconst weights:T.Weights = {};\n\t\tvar options\t\t= Object.assign({},optsUser);\n\n\t\tpropToArray(options,'sort');\n\t\tpropToArray(options,'sort_empty');\n\n\t\t// convert fields to new format\n\t\tif( options.fields ){\n\t\t\tpropToArray(options,'fields');\n\t\t\tconst fields:T.Field[] = [];\n\t\t\toptions.fields.forEach((field:string|T.Field) => {\n\t\t\t\tif( typeof field == 'string' ){\n\t\t\t\t\tfield = {field:field,weight:1};\n\t\t\t\t}\n\t\t\t\tfields.push(field);\n\t\t\t\tweights[field.field] = ('weight' in field) ? field.weight : 1;\n\t\t\t});\n\t\t\toptions.fields = fields;\n\t\t}\n\n\n\t\treturn {\n\t\t\toptions\t\t: options,\n\t\t\tquery\t\t: query.toLowerCase().trim(),\n\t\t\ttokens\t\t: this.tokenize(query, options.respect_word_boundaries, weights),\n\t\t\ttotal\t\t: 0,\n\t\t\titems\t\t: [],\n\t\t\tweights\t\t: weights,\n\t\t\tgetAttrFn\t: (options.nesting) ? getAttrNesting : getAttr,\n\t\t};\n\t};\n\n\t/**\n\t * Searches through all items and returns a sorted array of matches.\n\t *\n\t */\n\tsearch(query:string, options:T.Options) : T.PrepareObj {\n\t\tvar self = this, score, search:T.PrepareObj;\n\n\t\tsearch  = this.prepareSearch(query, options);\n\t\toptions = search.options;\n\t\tquery   = search.query;\n\n\t\t// generate result scoring function\n\t\tconst fn_score = options.score || self._getScoreFunction(search);\n\n\t\t// perform search and sort\n\t\tif (query.length) {\n\t\t\titerate(self.items, (item:T.ResultItem, id:string|number) => {\n\t\t\t\tscore = fn_score(item);\n\t\t\t\tif (options.filter === false || score > 0) {\n\t\t\t\t\tsearch.items.push({'score': score, 'id': id});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titerate(self.items, (_:T.ResultItem, id:string|number) => {\n\t\t\t\tsearch.items.push({'score': 1, 'id': id});\n\t\t\t});\n\t\t}\n\n\t\tconst fn_sort = self._getSortFunction(search);\n\t\tif (fn_sort) search.items.sort(fn_sort);\n\n\t\t// apply limits\n\t\tsearch.total = search.items.length;\n\t\tif (typeof options.limit === 'number') {\n\t\t\tsearch.items = search.items.slice(0, options.limit);\n\t\t}\n\n\t\treturn search;\n\t};\n}\n"],"names":["latin_pat","accent_pat","accent_reg","RegExp","diacritic_patterns","latin_convert","convert_pat","Object","keys","join","code_points","asciifold","str","normalize","replace","toLowerCase","foreignletter","arrayToPattern","chars","glue","length","undefined","longest","forEach","a","Math","max","escapeToPattern","escaped","map","diacritic","escape_regex","allSubstrings","input","result","substring","subresult","tmp","slice","charAt","push","unshift","generateDiacritics","diacritics","code_range","i","String","fromCharCode","latin","latin_diacritics","patt","match","latin_chars","sort","b","substrings","pattern","sub_pat","l","hasOwnProperty","diacriticRegexPoints","regex","decomposed","split","part","no_accent","getAttr","obj","name","getAttrNesting","names","shift","scoreValue","value","token","weight","score","pos","search","string","propToArray","key","Array","isArray","iterate","object","callback","cmp","Sifter","constructor","items","settings","tokenize","query","respect_word_boundaries","weights","tokens","words","field_regex","word","field_match","field","getScoreFunction","options","prepareSearch","_getScoreFunction","token_count","fields","field_count","getAttrFn","scoreObject","data","sum","conjunction","getSortFunction","_getSortFunction","n","implicit_score","self","sort_empty","sort_flds","multipliers","bind","get_field","id","direction","splice","sort_flds_count","multiplier","optsUser","assign","trim","total","nesting","fn_score","item","filter","_","fn_sort","limit"],"mappings":"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"}